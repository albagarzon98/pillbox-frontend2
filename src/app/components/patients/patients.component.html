<div class="limiter login-background">

  <!-- Esto se muestra cuando el tutor no tiene pacientes registrados -->
  <div class="container-home" *ngIf="patients.length == 0 && tutorAction == 'patientList'">
      <div class="box-patient-title">
          <span class="home-title-2">
              ¡Aún no tienes pacientes asignados!            
          </span>

          <div class="box-pharm mt-4" (click)="assignPatient()">
              <img src="../../../assets/images/paciente.png" alt="">

              <span>
                  Registrar paciente a cargo.
              </span>

          </div>
      </div>
  </div>

   <!-- Cuando el tutor tiene pacientes asignados se muestran estos -->
   <div class="container-reminder" *ngIf="patients.length != 0 && tutorAction == 'patientList'">
        <div class="container">
            <div class="row justify-content-center box-pharm">

                <span class="reminder-title">
                    Pacientes a cargo
                </span>

                <div class="empty-medications mt-4" *ngIf="patients.length == 0">
                    <span>
                        Aún no tienes medicamentos registrados.
                    </span>
                </div>

                <div class="container-login100-form-btn mb-4">
                    <button class="new-reminder-btn" (click)="assignPatient()">
                        <mat-icon style="transform: scale(0.9)" svgIcon="mas"></mat-icon>
                        &nbsp; Nuevo
                    </button>
                </div>

                <div class="reminder-box" *ngFor="let patient of patients">

                    <button mat-icon-button [matMenuTriggerFor]="menu">
                                <mat-icon>
                                    more_horiz
                                </mat-icon>
                        </button>
                    <mat-menu #menu="matMenu" class="box-reminder-menu" xPosition="after">
                        <button mat-menu-item (click)="viewPatientReminders(patient)">
                                <mat-icon >visibility</mat-icon>
                                <span class="poppins-regular">Ver medicamentos</span>
                            </button>
                        <button mat-menu-item (click)="deletePatient(patient)">
                            <mat-icon >delete</mat-icon>
                            <span class="poppins-regular">Eliminar paciente a cargo</span>
                            </button>
                    </mat-menu>

                    <!-- Según el genero se muestra la imagen correspondiente -->
                    <img class="reminder-image" src="../../../assets/images/female.png" alt="" *ngIf="patient.gender == 'Femenino'">
                    <img class="reminder-image" src="../../../assets/images/male.png" alt="" *ngIf="patient.gender == 'Masculino'">
                    <img class="reminder-image" src="../../../assets/images/other.png" alt="" *ngIf="patient.gender == 'Otro'">
                    
                    <!-- Se muestran los datos del paciente -->
                    <p class="box-reminder-medication-name">{{patient.fullName}}</p>
                    <span class="box-reminder-medication"> 
                            &nbsp; Correo: {{patient.email}}
                    </span>
                    <p class="box-reminder-medication">
                        &nbsp; Teléfono: {{patient.phoneNumber}}
                    </p>
                    <p class="box-reminder-medication">
                        &nbsp; Género: {{patient.gender}}
                    </p>

                </div>
            </div>
            
        </div>
    </div>
    <!-- El formulario se muestra cuando el usuario quiere asignar un nuevo paciente a cargo -->
    <div class="container container-home" *ngIf="tutorAction == 'assignPatient'">

        <div class="form-patient-container animated fadeInRight m-t-15">

            <!-- Regresar link -->
            <a class="pill-back-button" (click)="volver()">
                <span class="back">&lt;</span> &nbsp;Regresar
            </a>

            <span class="form-reminder-title mt-4 mb-4" *ngIf="tutorAction == 'assignPatient'">
                Asignar paciente a cargo
            </span>

            <form (ngSubmit)="onSubmit( FormPatient )" name="FormPatient" [formGroup]='FormPatient'>

                <div class="row">
                    <div class="col col-xs-12 div-border-rigth m-2">

                        <!-- Campo email -->
                        <div class="mb-4">
                            <label for="email" class="pill-label-reminder">Email del paciente a asignar:
                                <span class="material-icons-outlined infoAsignarPaciente" (click)="infoAsignarPaciente()">
                                    info
                                </span>
                            </label>

                            <input type="email" class="form-control input100" formControlName="email" placeholder="nombre@ejemplo.com" [ngClass]="{'is-invalid': (FormPatient.controls.email.touched || submitted)  
                            && FormPatient.controls.email.errors}" />

                            <div class="pill-danger animated fadeIn mt-1" *ngIf="(FormPatient.controls.email.touched || submitted) 
                            && FormPatient.controls.email.errors?.required">
                                Este campo es obligatorio.
                            </div>
                            <div class="pill-danger animated fadeIn mt-1" *ngIf="(FormPatient.controls.email.touched || submitted) 
                            && (FormPatient.controls.email.errors?.email) ">
                                Email inválido.
                            </div>
                        </div>

                    </div>
                </div>
                <div class="container-login100-form-btn" *ngIf="tutorAction == 'assignPatient'">
                    <button type="submit" class="pill-form-btn m-t-20">Enviar solicitud</button>
                </div>

            </form>

        </div>
    </div>

    <!-- Cuando el paciente tiene recordatorios registrados se muestran estos recordatorios -->
    <div class="container-reminder" *ngIf="tutorAction == 'reminderList'">
        <div class="container">
            
            <div class="row justify-content-center box-pharm">
                <span class="reminder-title">
                    Medicamentos del paciente
                </span>

                <div class="empty-medications mt-4" *ngIf="userReminders.length == 0">
                    <span>
                        El paciente no tiene medicamentos registrados.
                    </span>
                </div>

                <div class="container-login100-form-btn mb-4">
                    <button class="new-reminder-btn" (click)="addReminder()">
                        <mat-icon style="transform: scale(0.9)" svgIcon="mas"></mat-icon>
                        &nbsp; Asignar  Nuevo
                    </button>
                </div>

                <div class="reminder-box" *ngFor="let reminder of userReminders">

                    <button mat-icon-button [matMenuTriggerFor]="menu">
                                <mat-icon>
                                    more_horiz
                                </mat-icon>
                        </button>
                    <mat-menu #menu="matMenu" class="box-reminder-menu" xPosition="after">
                        <button mat-menu-item (click)="addReminder()">
                                <mat-icon >visibility</mat-icon>
                                <span class="poppins-regular">Ver medicamento</span>
                            </button>
                        <button mat-menu-item (click)="addReminder()">
                                <mat-icon >edit</mat-icon>
                                <span class="poppins-regular">Modificar medicamento</span>
                              </button>
                        <button mat-menu-item (click)="addReminder()">
                              <mat-icon >delete</mat-icon>
                              <span class="poppins-regular">Eliminar medicamento</span>
                            </button>
                    </mat-menu>

                    <!-- Según el tipo de unidad se muestra la imagen correspondiente -->
                    <img class="reminder-image" src="../../../assets/images/pills.png" alt="" *ngIf="reminder.unit == 'comprimido(s)'">
                    <img class="reminder-image" src="../../../assets/images/medicine.png" alt="" *ngIf="reminder.unit == 'cápsula(s)'">
                    <img class="reminder-image" src="../../../assets/images/syringe.png" alt="" *ngIf="reminder.unit == 'inyección(es)'">
                    <img class="reminder-image" src="../../../assets/images/cuentagotas.png" alt="" *ngIf="reminder.unit == 'gota(s)'">
                    <img class="reminder-image" src="../../../assets/images/balanza-de-cocina.png" alt="" *ngIf="reminder.unit == 'miligramo(s)'">
                    <img class="reminder-image" src="../../../assets/images/balanza-de-cocina.png" alt="" *ngIf="reminder.unit == 'gramo(s)'">
                    <img class="reminder-image" src="../../../assets/images/vaso-medidor.png" alt="" *ngIf="reminder.unit == 'mililitro(s)'">
                    <img class="reminder-image" src="../../../assets/images/drugs.png" alt="" *ngIf="reminder.unit == 'unidad(es)'">

                    <!-- Se muestran los datos del recordatorio -->
                    <p class="box-reminder-medication-name">{{reminder.medicationName}} {{reminder['grammage'] == null ? '':reminder['grammage'] + 'mg'}}</p>
                    <span class="box-reminder-medication"> 
                            <mat-icon svgIcon="pill-icon"></mat-icon>
                            &nbsp; Dosis: {{reminder.dose}}</span>
                    <span class="box-reminder-medication">{{reminder.unit}}</span>
                    <p class="box-reminder-medication">
                        <mat-icon class="material-icons-outlined">watch_later</mat-icon>
                        &nbsp; Frecuencia: {{reminder.frequency}}
                    </p>
                    <p class="box-reminder-medication">
                        <mat-icon class="material-icons-outlined">notifications</mat-icon>
                        &nbsp; Notificación: {{reminder['timeNotification']}} hs.
                    </p>
                    <p class="box-reminder-medication">
                        <mat-icon>event</mat-icon>
                        &nbsp; Fecha de inicio: {{reminder.startDate}}
                    </p>
                    <p class="box-reminder-medication">
                        <mat-icon>event</mat-icon>
                        &nbsp; Fecha de finalización: {{reminder.endDate}} <span *ngIf="!reminder.endDate">--/--/--</span>
                    </p>
                    <p class="box-reminder-medication">
                        <mat-icon class="material-icons-outlined">medication</mat-icon>
                        &nbsp; Stock: {{reminder.inventory}} <span *ngIf="!reminder.inventory">--</span>
                    </p>

                </div>
            </div>
            <div class="row justify-content-center box-pharm">
                <span class="reminder-title mb-4">
                    Medicamentos de farmacia
                </span>

                <div class="empty-medications" *ngIf="branchMedications.length == 0">
                    <span>
                        El paciente no tiene medicamentos de farmacia registrados.
                    </span>
                    <a class="pill-back-button-reminder" routerLink="/pharmacy">
                        Ir a farmacias
                        <mat-icon class="material-icons-outlined">
                            arrow_forward_ios
                        </mat-icon>
                    </a>
                </div>

                <div class="reminder-box" *ngFor="let medication of branchMedications">

                    <button mat-icon-button [matMenuTriggerFor]="menu">
                                <mat-icon>
                                    more_horiz
                                </mat-icon>
                    </button>
                    <mat-menu #menu="matMenu" class="box-reminder-menu" xPosition="after">
                        <button mat-menu-item (click)="addReminder()">
                                <mat-icon >visibility</mat-icon>
                                <span class="poppins-regular">Ver medicamento</span>
                        </button>
                        <button mat-menu-item (click)="addReminder()">
                                <mat-icon >edit</mat-icon>
                                <span class="poppins-regular">Modificar medicamento</span>
                              </button>
                        <button mat-menu-item (click)="addReminder()">
                              <mat-icon >delete</mat-icon>
                              <span class="poppins-regular">Eliminar medicamento</span>
                            </button>
                    </mat-menu>

                    <!-- Según el tipo de unidad se muestra la imagen correspondiente -->
                    <img class="reminder-image" src="../../../assets/images/pills.png" alt="" *ngIf="medication['branchMedication']['unit'] == 'comprimido(s)'">
                    <img class="reminder-image" src="../../../assets/images/medicine.png" alt="" *ngIf="medication['branchMedication']['unit'] == 'cápsula(s)'">
                    <img class="reminder-image" src="../../../assets/images/syringe.png" alt="" *ngIf="medication['branchMedication']['unit'] == 'inyección(es)'">
                    <img class="reminder-image" src="../../../assets/images/cuentagotas.png" alt="" *ngIf="medication['branchMedication']['unit'] == 'gota(s)'">
                    <img class="reminder-image" src="../../../assets/images/balanza-de-cocina.png" alt="" *ngIf="medication['branchMedication']['unit'] == 'miligramo(s)'">
                    <img class="reminder-image" src="../../../assets/images/balanza-de-cocina.png" alt="" *ngIf="medication['branchMedication']['unit'] == 'gramo(s)'">
                    <img class="reminder-image" src="../../../assets/images/vaso-medidor.png" alt="" *ngIf="medication['branchMedication']['unit'] == 'mililitro(s)'">
                    <img class="reminder-image" src="../../../assets/images/drugs.png" alt="" *ngIf="medication['branchMedication']['unit'] == 'unidad(es)'">

                    <!-- Se muestran los datos del recordatorio -->
                    <p class="box-reminder-medication-name">{{medication['branchMedication']['medicationName']}} {{medication['branchMedication']['grammage'] == null ? '':medication['branchMedication']['grammage'] }}</p>
                    <span class="box-reminder-medication"> 
                            <mat-icon svgIcon="pill-icon"></mat-icon>
                            &nbsp; Dosis: {{medication['dose']}}</span>
                    <span class="box-reminder-medication">{{medication['branchMedication']['unit']}}</span>
                    <p class="box-reminder-medication">
                        <mat-icon class="material-icons-outlined">watch_later</mat-icon>
                        &nbsp; Frecuencia: {{medication['frequency']}}
                    </p>
                    <p class="box-reminder-medication">
                        <mat-icon class="material-icons-outlined">notifications</mat-icon>
                        &nbsp; Notificación: {{medication['timeNotification']}} hs.
                    </p>
                    <p class="box-reminder-medication">
                        <mat-icon>event</mat-icon>
                        &nbsp; Fecha de inicio: {{medication['startDate']}}
                    </p>
                    <p class="box-reminder-medication">
                        <mat-icon>event</mat-icon>
                        &nbsp; Fecha de finalización: {{medication['endDate']}} <span *ngIf="!medication['endDate']">--/--/--</span>
                    </p>
                    <p class="box-reminder-medication">
                        <mat-icon class="material-icons-outlined">medication</mat-icon>
                        &nbsp; Stock: {{medication['inventory']}} <span *ngIf="!medication['inventory']">--</span>
                    </p>

                </div>
            </div>
        </div>
    </div>
</div>